<!DOCTYPE html>
<html lang="id">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>History Pesanan - RamStore</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
	<style>
		:root{--accent:#ff7a18;--muted:#6b7280}
		body{font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial;padding-top:56px;background:#f8fafc}
		main{padding:30px 20px;max-width:1000px;margin:0 auto;min-height:calc(100vh - 150px)}
		.order-card{background:#fff;border-radius:12px;padding:20px;box-shadow:0 2px 8px rgba(0,0,0,0.06);margin-bottom:20px;border-left:4px solid var(--accent)}
		.order-card:hover{box-shadow:0 8px 20px rgba(0,0,0,0.12)}
		.order-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;flex-wrap:wrap;gap:10px}
		.order-id{font-weight:700;font-size:1.1rem;color:#1f2937}
		.order-date{color:var(--muted);font-size:0.9rem}
		.status-badge{padding:6px 12px;border-radius:20px;font-size:0.85rem;font-weight:600}
		.status-pending{background:#fef3c7;color:#92400e}
		.status-processing{background:#dbeafe;color:#1e40af}
		.status-shipped{background:#d1fae5;color:#065f46}
		.status-delivered{background:#dcfce7;color:#166534}
		.status-cancelled{background:#fee2e2;color:#991b1b}
		.order-details{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin:15px 0;padding:15px 0;border-top:1px solid #e5e7eb;border-bottom:1px solid #e5e7eb}
		.detail-item{font-size:0.9rem}
		.detail-label{color:var(--muted);margin-bottom:4px}
		.detail-value{font-weight:600;color:#1f2937;font-size:1rem}
		.order-items{margin-top:15px}
		.item-row{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #f3f4f6;font-size:0.9rem}
		.item-row:last-child{border-bottom:none}
		.item-name{font-weight:500;color:#1f2937}
		.item-qty{color:var(--muted)}
		.item-price{font-weight:600;color:var(--accent)}
		.order-summary{background:#f9fafb;padding:15px;border-radius:8px;margin-top:15px;text-align:right}
		.summary-row{display:flex;justify-content:space-between;margin-bottom:8px;font-size:0.9rem}
		.summary-total{font-size:1.1rem;font-weight:700;color:var(--accent);margin-top:10px;padding-top:10px;border-top:2px solid #e5e7eb}
		.empty-state{text-align:center;padding:60px 20px}
		.empty-state i{font-size:4rem;color:#cbd5e1;margin-bottom:20px}
		.btn-detail{padding:6px 16px;font-size:0.85rem;border-radius:20px}
		.page-loader{position:fixed;inset:0;background:rgba(255,255,255,0.92);display:flex;align-items:center;justify-content:center;z-index:9999}
	</style>
</head>
<body>
	<div id="page-loader" class="page-loader">
		<div class="spinner-border text-primary" role="status">
			<span class="visually-hidden">Memuatâ€¦</span>
		</div>
	</div>

	<header class="site-header">
		<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
			<div class="container-fluid" style="padding:0 20px;max-width:1400px;margin:0 auto">
				<a class="navbar-brand" href="index.html">
					<i class="bi bi-shop me-2"></i>RamStore
				</a>
				<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarNav">
					<ul class="navbar-nav me-auto">
						<li class="nav-item"><a class="nav-link" href="index.html">Beranda</a></li>
						<li class="nav-item"><a class="nav-link" href="alamat.html">Alamat</a></li>
						<li class="nav-item"><a class="nav-link" href="kontak.html">Kontak</a></li>
						<li class="nav-item"><a class="nav-link" href="tentang.html">Tentang</a></li>
					</ul>
					<ul class="navbar-nav">
						<li class="nav-item"><a class="nav-link" href="profile.html"><i class="bi bi-person me-1"></i>Profil</a></li>
						<li class="nav-item"><a class="nav-link active" href="history.html"><i class="bi bi-receipt me-1"></i>History</a></li>
						<li class="nav-item"><a class="nav-link" href="#" id="logout-btn"><i class="bi bi-box-arrow-right me-1"></i>Logout</a></li>
					</ul>
				</div>
			</div>
		</nav>
	</header>

	<main>
		<h1 class="mb-4"><i class="bi bi-receipt me-2"></i>History Pesanan Saya</h1>

		<div id="orders-container"></div>
	</main>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
	<script>
		function hidePageLoader() {
			const loader = document.getElementById('page-loader');
			if (loader) loader.style.display = 'none';
		}

		async function loadOrders() {
			try {
				const response = await fetch('api/orders.php?action=get_user_orders');
				
				if (!response.ok) {
					if (response.status === 401) {
						window.location.href = 'login.html';
						return;
					}
					throw new Error('Gagal memuat orders');
				}

				const orders = await response.json();
				displayOrders(orders);
			} catch (error) {
				console.error('Error:', error);
				document.getElementById('orders-container').innerHTML = `
					<div class="alert alert-danger">
						<i class="bi bi-exclamation-triangle me-2"></i>
						Gagal memuat history pesanan
					</div>
				`;
			} finally {
				hidePageLoader();
			}
		}

		function displayOrders(orders) {
			const container = document.getElementById('orders-container');

			if (orders.length === 0) {
				container.innerHTML = `
					<div class="empty-state">
						<i class="bi bi-bag-x"></i>
						<h3>Belum Ada Pesanan</h3>
						<p class="text-muted mb-4">Anda belum membuat pesanan apapun</p>
						<a href="index.html" class="btn btn-primary"><i class="bi bi-shop me-2"></i>Mulai Belanja</a>
					</div>
				`;
				return;
			}

			container.innerHTML = orders.map(order => `
				<div class="order-card">
					<div class="order-header">
						<div>
							<div class="order-id">Order: ${order.order_id}</div>
							<div class="order-date">
								<i class="bi bi-calendar me-1"></i>
								${new Date(order.created_at).toLocaleDateString('id-ID', {
									year: 'numeric',
									month: 'long',
									day: 'numeric'
								})}
							</div>
						</div>
						<span class="status-badge status-${order.status}">
							${getStatusLabel(order.status)}
						</span>
					</div>

					<div class="order-details">
						<div class="detail-item">
							<div class="detail-label">Metode Pengiriman</div>
							<div class="detail-value">${order.shipping_method || 'Ambil di Toko'}</div>
						</div>
						<div class="detail-item">
							<div class="detail-label">Biaya Pengiriman</div>
							<div class="detail-value">Rp ${formatPrice(order.shipping_cost)}</div>
						</div>
						<div class="detail-item">
							<div class="detail-label">Pajak (PPN)</div>
							<div class="detail-value">Rp ${formatPrice(order.tax)}</div>
						</div>
						<div class="detail-item">
							<div class="detail-label">Total</div>
							<div class="detail-value" style="color:var(--accent)">Rp ${formatPrice(order.total)}</div>
						</div>
					</div>

					<div class="d-grid gap-2 d-sm-flex justify-content-end mt-3">
						<button class="btn btn-sm btn-outline-primary btn-detail" onclick="viewOrderDetail(${order.id})">
							<i class="bi bi-eye me-1"></i>Lihat Detail
						</button>
					</div>
				</div>
			`).join('');
		}

		function getStatusLabel(status) {
			const labels = {
				'pending': 'Menunggu Konfirmasi',
				'processing': 'Sedang Diproses',
				'shipped': 'Sedang Dikirim',
				'delivered': 'Terkirim',
				'cancelled': 'Dibatalkan'
			};
			return labels[status] || status;
		}

		function formatPrice(price) {
			return new Intl.NumberFormat('id-ID', {
				minimumFractionDigits: 0,
				maximumFractionDigits: 0
			}).format(price);
		}

		function viewOrderDetail(orderId) {
			window.location.href = `order-detail.html?id=${orderId}`;
		}

		document.getElementById('logout-btn').addEventListener('click', (e) => {
			e.preventDefault();
			if (confirm('Yakin ingin logout?')) {
				localStorage.clear();
				window.location.href = 'index.html';
			}
		});

		loadOrders();
	</script>
</body>
</html>